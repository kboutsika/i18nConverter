var Overlay={initialize:function(t){this.build(t),this.addEvents()},build:function(t){var e=$("body");this.closeImg=$("<img />",{src:"./images/close-button.png",alt:"Close",width:"15"});var i=document.createElement("div");$(i).addClass("overlay-content"),i.innerText=t,e.addClass("shadow"),this.overlay=document.createElement("div"),$(this.overlay).addClass("overlay animate"),$(this.overlay).append(this.closeImg),$(this.overlay).append(i),e.append($(this.overlay))},addEvents:function(){var t=this;this.closeImg.click(function(){$(t.overlay).remove(),$("body").removeClass("shadow")})}},Tree={initialize:function(t,e,i){html_=[],tree_={},this.$el=$(t),this.render(this.buildFromPathList(e)),this.$el.html(html_.join("")).tree({expanded:"li:first"});for(var n,s=this.$el.get(0).querySelectorAll("[data-type='file']"),l=0;n=s[l];++l)n.dataset.index=l;this.addEvents(i)},addEvents:function(t){var e,i;this.$el.click(function(n){e=n.target,"A"===e.nodeName&&"file"===e.dataset.type&&(i=t[e.dataset.index],Overlay.initialize(i))})},buildFromPathList:function(t){for(var e,i=0;e=t[i];++i)for(var n,s=e.split("/"),l=tree_,a=0;n=s[a];++a)l[n]||(l[n]=a<s.length-1?{}:null),l=l[n];return tree_},render:function(t){if(t)for(var e in t)t[e]?(html_.push('<li><a href="#">',e,"</a>"),html_.push("<ul>"),this.render(t[e]),html_.push("</ul>")):html_.push('<li><a href="#" data-type="file">',e,"</a></li>")}},Converter={initialize:function(){this.fileInput=document.getElementById("file-input"),this.outeputPlaceholder=document.getElementById("obj-output"),this.i18nObject={},this.pathList=[],this.files=[],this.fileContentsList=[],this.addEvents()},addEvents:function(){var t=this;this.fileInput.addEventListener("change",function(e){t.openFolder(e.target)});new Clipboard(".btn")},openFolder:function(t){this.files=t.files;var e,i=0;if(this.files.length){for(i=0;i<this.files.length;i++)e=this.files[i],this.getLan(e,i);Tree.initialize("#folder-struct",this.pathList,this.fileContentsList),$("#files").addClass("full")}},readXMLFile:function(t,e,i){var n=new FileReader,s=this;n.onload=function(t){s.XMLText=n.result,s.fileContentsList.push(s.XMLText),s.cleanXMLText(),s.createI18nObject(e),i==s.files.length-1&&(s.buildHTMLOutput(),console.log(s.i18nObject))},n.readAsText(t)},getLan:function(t,e){var i=t.webkitRelativePath,n=/\/(.*?)\//,s=n.exec(i);return-1!==i.indexOf("i18n")&&s&&s.length?(this.pathList.push(i),void this.readXMLFile(t,s[1],e)):void alert('You did not choose the folder "i18n" or something is not correct.')},cleanXMLText:function(){this.XMLText=this.XMLText.replace(/<!--[\s\S]*?-->/g,""),this.XMLText=this.XMLText.replace(/<\?xml[\s\S]*?\?>/g,""),this.XMLText=this.XMLText.replace(/<resources>/,""),this.XMLText=this.XMLText.replace(/<\/resources>/,""),this.XMLText=this.XMLText.replace(/^\s*[\r\n]/gm,"")},createI18nObject:function(t){this.i18nObject[t]={};for(var e,i,n=/<string\b[^>]*>([\s\S]*?)<\/string>/gm,s=/ name="([^"]*)"/;e=n.exec(this.XMLText);)i=s.exec(e[0]),this.i18nObject[t][i[1]]=e[1]},buildHTMLOutput:function(){var t="{\n";for(var e in this.i18nObject){t+=e+": {\n";for(var i in this.i18nObject[e])t+=i+':"'+this.i18nObject[e][i]+'",\n';t+="},\n"}t+="}",this.outeputPlaceholder.innerText=t}};document.addEventListener("DOMContentLoaded",function(t){Converter.initialize()});